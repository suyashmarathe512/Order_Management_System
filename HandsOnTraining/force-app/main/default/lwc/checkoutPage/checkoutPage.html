<template>
  <div class="slds-box slds-theme_default checkout">
    <div class="slds-page-header">
      <div class="slds-page-header__row">
        <div class="slds-page-header__col-title">
          <div class="slds-media">
            <div class="slds-media__body">
              <div class="slds-page-header__name-title">
                <h1 class="slds-page-header__title slds-truncate" title="Checkout">Checkout</h1>
                <template if:true={accountName}>
                  <div class="slds-page-header__name-meta">Account: {accountName}</div>
                </template>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <template if:true={cart.length}>
      <div class="slds-section slds-is-open">
        <div class="slds-section__content">
          <div class="slds-grid slds-gutters slds-wrap">
            <div class="slds-col slds-size_1-of-1">
              <div class="slds-table_container">
                <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                  <thead>
                    <tr class="slds-line-height_reset">
                      <th class="slds-text-heading_label" scope="col">Product</th>
                      <th class="slds-text-heading_label" scope="col">Quantity</th>
                      <th class="slds-text-heading_label" scope="col">Unit Price</th>
                      <th class="slds-text-heading_label" scope="col">Line Total</th>
                      <th class="slds-text-heading_label" scope="col">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <template for:each={cart} for:item="item">
                      <tr key={item.id} class="slds-hint-parent">
                        <td>
                          <div class="product-name" title={item.name}>{item.name}</div>
                          <div class="product-sku">SKU: {item.sku}</div>
                        </td>
                        <td>
                          <div class="slds-grid slds-grid_vertical-align-center qty-editor">
                            <button class="slds-button slds-button_icon slds-button_icon-border-filled"
                                    title="Decrease"
                                    data-id={item.id}
                                    data-dir="dec"
                                    onclick={handleQtyButton}>
                              <lightning-icon icon-name="utility:dash" size="x-small"></lightning-icon>
                            </button>
                            <input type="number"
                                   min="1"
                                   max="9999"
                                   value={item.qty}
                                   data-id={item.id}
                                   onchange={handleQtyChange}
                                   class="slds-input slds-m-horizontal_small"
                                   style="width:6rem" />
                            <button class="slds-button slds-button_icon slds-button_icon-border-filled"
                                    title="Increase"
                                    data-id={item.id}
                                    data-dir="inc"
                                    onclick={handleQtyButton}>
                              <lightning-icon icon-name="utility:add" size="x-small"></lightning-icon>
                            </button>
                          </div>
                        </td>
                        <td class="slds-text-align_right unit-price">{item.formattedPrice}</td>
                        <td class="slds-text-align_right line-total">{item.formattedLineTotal}</td>
                        <td>
                          <button data-id={item.id} onclick={removeLine} class="slds-button slds-button_outline-brand slds-button_neutral slds-button_small remove-btn">Remove</button>
                        </td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="slds-box slds-theme_shade summary">
            <div class="slds-grid slds-gutters slds-wrap">
              <div class="slds-col slds-size_1-of-1">
                <div class="slds-text-heading_medium total">Total: {formattedTotal}</div>
              </div>
              <div class="slds-col slds-size_1-of-1">
                <div class="slds-form-element">
                  <div class="slds-form-element__control">
                    <div class="slds-grid slds-gutters">
                    </div>
                  </div>
                </div>
              </div>
              <!-- 
              <div class="slds-col slds-size_1-of-1">
                  <div class="slds-form-element">
                    <label class="slds-form-element__label">Select Contract</label>
                    <div class="slds-form-element__control">
                      <select class="slds-select" value={selectedContractId} onchange={handleContractChange}>
                        <option value="">-- Select a Contract --</option>
                        <template for:each={contracts} for:item="contract">
                          <option key={contract.Id} value={contract.Id}>{contract.Contract_Name__c}</option>
                        </template>
                      </select>
                    </div>
                  </div>
              </div>
              -->
              <div class="slds-col slds-size_1-of-1">
                <div class="slds-grid slds-gutters slds-wrap">
                  <div class="slds-col slds-size_1-of-2">
                    <div class="slds-section">
                      <h3 class="slds-section__title address-title">Billing Address</h3>
                      <div class="slds-section__content address-content">
                        <div class="slds-form-element">
                          <label class="slds-form-element__label">Street</label>
                          <div class="slds-form-element__control">
                            <input type="text" class="slds-input" value={billingAddress.street} onchange={handleBillingChange} data-field="street" />
                          </div>
                        </div>
                        <div class="slds-form-element">
                          <label class="slds-form-element__label">City</label>
                          <div class="slds-form-element__control">
                            <input type="text" class="slds-input" value={billingAddress.city} onchange={handleBillingChange} data-field="city" />
                          </div>
                        </div>
                        <div class="slds-form-element">
                          <label class="slds-form-element__label">State</label>
                          <div class="slds-form-element__control">
                            <input type="text" class="slds-input" value={billingAddress.state} onchange={handleBillingChange} data-field="state" />
                          </div>
                        </div>
                        <div class="slds-form-element">
                          <label class="slds-form-element__label">Postal Code</label>
                          <div class="slds-form-element__control">
                            <input type="text" class="slds-input" value={billingAddress.postalCode} onchange={handleBillingChange} data-field="postalCode" />
                          </div>
                        </div>
                        <div class="slds-form-element">
                          <label class="slds-form-element__label">Country</label>
                          <div class="slds-form-element__control">
                            <input type="text" class="slds-input" value={billingAddress.country} onchange={handleBillingChange} data-field="country" />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="slds-col slds-size_1-of-2">
                    <div class="slds-section">
                      <h3 class="slds-section__title address-title">Shipping Address</h3>
                      <div class="slds-section__content address-content">
                        <div class="slds-form-element">
                          <label class="slds-form-element__label">Street</label>
                          <div class="slds-form-element__control">
                            <input type="text" class="slds-input" value={shippingAddress.street} onchange={handleShippingChange} data-field="street" />
                          </div>
                        </div>
                        <div class="slds-form-element">
                          <label class="slds-form-element__label">City</label>
                          <div class="slds-form-element__control">
                            <input type="text" class="slds-input" value={shippingAddress.city} onchange={handleShippingChange} data-field="city" />
                          </div>
                        </div>
                        <div class="slds-form-element">
                          <label class="slds-form-element__label">State</label>
                          <div class="slds-form-element__control">
                            <input type="text" class="slds-input" value={shippingAddress.state} onchange={handleShippingChange} data-field="state" />
                          </div>
                        </div>
                        <div class="slds-form-element">
                          <label class="slds-form-element__label">Postal Code</label>
                          <div class="slds-form-element__control">
                            <input type="text" class="slds-input" value={shippingAddress.postalCode} onchange={handleShippingChange} data-field="postalCode" />
                          </div>
                        </div>
                        <div class="slds-form-element">
                          <label class="slds-form-element__label">Country</label>
                          <div class="slds-form-element__control">
                            <input type="text" class="slds-input" value={shippingAddress.country} onchange={handleShippingChange} data-field="country" />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
           <div class="slds-m-top_medium" style="align-items">
          <lightning-button 
            label="Place Order" 
            variant="brand" 
            onclick={placeOrder}
            disabled={isLoading}>
          </lightning-button>
        </div>
          <template if:true={orderResult}>
            <div class="slds-box slds-theme_shade invoice-section">
              <div class="slds-grid slds-gutters">
                <div class="slds-col slds-size_1-of-1">
                  <h3 class="slds-section__title">Invoice Statement</h3>
                  <div class="invoice-container">
                    <iframe src={orderResult.pdfDownloadUrl} width="100%" height="600" frameborder="0"></iframe>
                  </div>
          </div>
        </div>
      </div>
    </template>
        </div>
      </div>
    </template>
    <template if:false={cart.length}>
      <div class="slds-text-align_center empty-cart">
        <div>Your cart is empty.</div>
        <div class="slds-text-body_small">Add items to your cart to proceed with checkout.</div>
      </div>
    </template>
  </div>
</template>
