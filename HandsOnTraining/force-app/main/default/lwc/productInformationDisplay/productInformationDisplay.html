<template>
  <lightning-card title="Product Catalog" icon-name="standard:product">
    <div class="controls slds-p-around_medium">
      <div class="slds-grid slds-wrap slds-grid_align-spread slds-grid_vertical-align-center">
        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-right_small">
          <lightning-input type="search" placeholder="Search products or SKU" value={searchKey} onchange={onSearchChange} debounce="300"></lightning-input>
        </div>
        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-text-align_right slds-p-left_small">
          <lightning-button-icon icon-name="utility:filterList" alternative-text="Filters" title="Filters" onclick={openFilterPanel}></lightning-button-icon>
          <lightning-button variant="brand" label="Create Order" onclick={onCreateOrder}></lightning-button>
        </div>
      </div>
    </div>

    <div class="slds-p-horizontal_medium">
      <template if:true={isLoading}>
        <div class="slds-grid slds-wrap slds-grid_align-spread">
          <div key={s} class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3" for:each={skeletons} for:item="s">
            <div class="product-skeleton slds-box slds-m-around_small">
              <div class="slds-skeleton slds-skeleton_rectangle skeleton-image"></div>
              <div class="slds-skeleton slds-skeleton_text"></div>
              <div class="slds-skeleton slds-skeleton_text"></div>
            </div>
          </div>
        </div>
      </template>

      <div class="product-grid slds-grid" onscroll={onGridScroll} data-id="productGrid">
        <template if:true={products}>
          <template for:each={products} for:item="product">
            <div key={product.id} class="product-card-wrapper slds-col slds-size_1-of-4">
              <c-product-card product={product} onaddtocart={handleAddToCart} onviewdetails={handleViewDetails}></c-product-card>
            </div>
          </template>
        </template>

        <template if:true={noResults}>
          <div class="slds-text-align_center slds-p-vertical_large">No products found.</div>
        </template>
      </div>

      <template if:true={isLoadingMore}>
        <div class="slds-text-align_center slds-m-vertical_medium">
          <lightning-spinner alternative-text="Loading more products"></lightning-spinner>
        </div>
      </template>
    </div>
  </lightning-card>
  <template if:true={showModal}>
    <section role="dialog" tabindex="-1" aria-modal="true" aria-label="Product details" class="slds-modal slds-fade-in-open">
      <div class="slds-modal__container">
        <header class="slds-modal__header">
          <lightning-button-icon icon-name="utility:close" alternative-text="Close" onclick={closeModal}></lightning-button-icon>
          <h2 class="slds-text-heading_medium">{modalProduct.name}</h2>
        </header>
        <div class="slds-modal__content slds-p-around_medium">
          <p>{modalProduct.description}</p>
          <p><strong>SKU:</strong> {modalProduct.sku}</p>
          <p><strong>Price:</strong> {modalProduct.price}</p>
        </div>
        <footer class="slds-modal__footer slds-grid slds-grid_align-end">
          <lightning-button variant="neutral" label="Close" onclick={closeModal}></lightning-button>
          <lightning-button variant="brand" label="Add to Cart" onclick={modalAddToCart}></lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>
</template>
